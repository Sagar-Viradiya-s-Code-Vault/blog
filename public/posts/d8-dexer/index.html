<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The D8 Dexer | Sagar's Blog</title>
<meta name=keywords content="Android,Compilation,Tool Chain"><meta name=description content="New faster and optimised compiler"><meta name=author content><link rel=canonical href=https://sagarviradiya.dev/posts/d8-dexer/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.0ca7eb5c58d462c1500c10b5503144143e6a21142fc22557ae94a8112158af8d.css integrity="sha256-DKfrXFjUYsFQDBC1UDFEFD5qIRQvwiVXrpSoESFYr40=" rel="preload stylesheet" as=style><link rel=icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="The D8 Dexer"><meta property="og:description" content="New faster and optimised compiler"><meta property="og:type" content="article"><meta property="og:url" content="https://sagarviradiya.dev/posts/d8-dexer/"><meta property="og:image" content="https://sagarviradiya.dev/images/header.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-02T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-02T00:00:00+00:00"><meta property="og:site_name" content="Sagar's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sagarviradiya.dev/images/header.jpeg"><meta name=twitter:title content="The D8 Dexer"><meta name=twitter:description content="New faster and optimised compiler"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sagarviradiya.dev/posts/"},{"@type":"ListItem","position":2,"name":"The D8 Dexer","item":"https://sagarviradiya.dev/posts/d8-dexer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The D8 Dexer","name":"The D8 Dexer","description":"New faster and optimised compiler","keywords":["Android","Compilation","Tool Chain"],"articleBody":"As an android dev we all are in concern with our app build time and app size. Faster build means more productivity and smaller APK size benefits your user and your product. That’s why we are always on the hunt of ways to optimize our build time as much as we can. For example, with the release of gradle plugin 3.0 one can leverage significant performance improvements to large multi-module projects.\nHowever, there are certain steps in build process which contributes to build time and developer can’t do anything to optimize it. Dex compilation (Dexing) is one such process which mostly works under the hood in your day-to-day app development, but it directly impacts your app’s build time, .dex file size, and runtime performance.\nFor those who don’t know what is dex compilation ? Dex compilation is a process of transforming .class bytecode into .dex bytecode for the Android Runtime (ART) (or Dalvik Virtual Machine for older version of android).\nThanks to android tools team to come up with next-generation dex compiler, D8. D8 is the replacement for DX and it comes with new release of Android Studio 3.1.0 (Also available in studio 3.0 but disabled by default). D8 offers many advantages but before diving into D8 advantages let’s step back and explore default toolchain with desugaring to better understand all benefits D8 offers.\nDefault toolchain with desugaring Remember Jack toolchain (deprecated now)? Which got introduced as a replacement of default toolchain to support java 8 features on android. But jack got deprecated due to the fact that it coverts your source code to .dex directly with no bytecode in between and developers relying on bytecode tools couldn’t use it. Besides it was slow in compilation.\nFast forward to today, android’s default toolchain provides built-in support for certain Java 8 language features using concept of desugaring. Now you may ask what is desugaring ?\nAs you can see in the figure below it is a process which coverts java 8 bytecode generated by javac to java 7 compatible bytecode. This is the secret behind supporting certain java 8 features on all android versions by default toolchain.\nJava 8 language feature support using desugar bytecode transformations.\nOkay so enough theory, let’s see one example of desugaring to make it clear.\nLambda is one of the popular java 8 feature and all devs love it because it makes your code easy to read by reducing boilerplate code. Since android runtime (ART or dalvik) doesn’t support java 8 natively it won’t be able to recognise lambda. Desugaring converts lambda expression into an anonymous class which is java 7 compatible.\nSo you can write click listener on the button using java 8 lambda feature like this\nbutton.setOnClickListener(v -\u003e Log.d(\"Button clicked\")); which gets desugared to something like this\nbutton.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { Log.d(\"Button clicked\"); } }); For more information on default toolchain head over to the this page.\nOkay, now we know enough about default toolchain so let’s explore advantages of D8 dexer.\nAdvantages of D8 dexer As I said earlier D8 is a new dex compiler which is integrated with gradle plugin 3.1.0. D8 is faster compare to DX thereby reducing build time and also it generates small .dex file thereby reducing your APK size. Also, it generates optimized .dex which gives you better run time performance.\nFigures below show dex compilation time and dex file size comparison with DX.\nCompile time comparison\nTested with benchmark project here.\nDEX size comparison\nTested with benchmark project here.\nTo take advantage of D8 all you need to do is to update your Android Studio to latest version 3.1.0.\nYou can further optimize your build time using D8 experimental feature called integrated desugaring. We have seen in default toolchain, desugaring is a separate process which runs immediately after java compilation as shown below.\nDefault toolchain desugaring\nWith new experimental integrated desugaring it will be a part of D8 which will reduce your build time further.\nD8 integrated desugaring\nSince it is an experimental feature you have to enable it by adding the following line in your gradle.properties file.\nandroid.enableD8.desugaring = true Once it is stable it will be enabled by default in future Android Studio release.\nWhat’s next ? Besides D8 dexer android tools team is also working on R8 shrinker, which is a proguard replacement for whole program minification and optimization. Think of R8 as D8 on steroids. It will convert your java bytecode to .dex by removing unused code and obfuscating it just like proguard.\nCurrently, it is not integrated with android gradle plugin but those who are curious about R8 can head over to open-sourced R8 project here.\nFinally, I would like to close this with a resource which will help you to understand D8 and R8 better. Tune into following podcast where @chethaase and @tornorbye talk with Jeffrey van Gogh from the Tools team who works on D8 and R8.\nEpisode 86: It’s gr8!\nIn case if you have any question or suggestion you can comment below or get in touch with me on twitter.\nThat’s it for now folks :)\nThis was originally posted on Medium\n","wordCount":"859","inLanguage":"en","image":"https://sagarviradiya.dev/images/header.jpeg","datePublished":"2018-04-02T00:00:00Z","dateModified":"2018-04-02T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sagarviradiya.dev/posts/d8-dexer/"},"publisher":{"@type":"Organization","name":"Sagar's Blog","logo":{"@type":"ImageObject","url":"https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sagarviradiya.dev/ accesskey=h title="127.0.0.1 (Alt + H)"><img src=https://sagarviradiya.dev/apple-touch-icon.png alt aria-label=logo height=35>127.0.0.1</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sagarviradiya.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://sagarviradiya.dev/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://sagarviradiya.dev/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://sagarviradiya.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sagarviradiya.dev/>Home</a>&nbsp;»&nbsp;<a href=https://sagarviradiya.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">The D8 Dexer</h1><div class=post-meta><span title='2018-04-02 00:00:00 +0000 UTC'>April 2, 2018</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;859 words</div></header><figure class=entry-cover><a href=https://sagarviradiya.dev/posts/d8-dexer/images/header.jpeg target=_blank rel="noopener noreferrer"><img loading=eager srcset="https://sagarviradiya.dev/posts/d8-dexer/images/header_huaa179a92f6421e1672ee765b26326db8_168296_360x0_resize_q75_box.jpeg 360w ,https://sagarviradiya.dev/posts/d8-dexer/images/header_huaa179a92f6421e1672ee765b26326db8_168296_480x0_resize_q75_box.jpeg 480w ,https://sagarviradiya.dev/posts/d8-dexer/images/header_huaa179a92f6421e1672ee765b26326db8_168296_720x0_resize_q75_box.jpeg 720w ,https://sagarviradiya.dev/posts/d8-dexer/images/header_huaa179a92f6421e1672ee765b26326db8_168296_1080x0_resize_q75_box.jpeg 1080w ,https://sagarviradiya.dev/posts/d8-dexer/images/header.jpeg 1280w" sizes="(min-width: 768px) 720px, 100vw" src=https://sagarviradiya.dev/posts/d8-dexer/images/header.jpeg alt="[Image source](https://i.ytimg.com/vi/d-zKJCKsoWw/maxresdefault.jpg)" width=1280 height=720></a><p><a href=https://i.ytimg.com/vi/d-zKJCKsoWw/maxresdefault.jpg>Image source</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#advantages-of-d8-dexer>Advantages of D8 dexer</a></li><li><a href=#whats-next->What’s next ?</a></li></ul></nav></div></details></div><div class=post-content><p>As an android dev we all are in concern with our app build time and app size. Faster build means more productivity and smaller APK size benefits your user and your product. That’s why we are always on the hunt of ways to optimize our build time as much as we can. For example, with the release of gradle plugin 3.0 one can leverage significant performance improvements to large multi-module projects.</p><p>However, there are certain steps in build process which contributes to build time and developer can’t do anything to optimize it. Dex compilation (Dexing) is one such process which mostly works under the hood in your day-to-day app development, but it directly impacts your app’s build time, .dex file size, and runtime performance.</p><blockquote><p><em>For those who don’t know what is <strong>dex compilation</strong> ?
Dex compilation is a process of transforming .class bytecode into .dex bytecode for the Android Runtime (ART) (or Dalvik Virtual Machine for older version of android).</em></p></blockquote><p>Thanks to android tools team to come up with next-generation dex compiler, D8. D8 is the replacement for DX and it comes with new release of Android Studio 3.1.0 (Also available in studio 3.0 but disabled by default). D8 offers many advantages but before diving into D8 advantages let’s step back and explore default toolchain with desugaring to better understand all benefits D8 offers.</p><p>Default toolchain with desugaring
Remember <a href=https://source.android.com/setup/build/jack>Jack toolchain</a> (deprecated now)? Which got introduced as a replacement of default toolchain to support java 8 features on android. But jack got deprecated due to the fact that it coverts your source code to .dex directly with no bytecode in between and developers relying on bytecode tools couldn’t use it. Besides it was slow in compilation.</p><p>Fast forward to today, android’s default toolchain provides built-in support for certain Java 8 language features using concept of desugaring. Now you may ask what is desugaring ?</p><iframe width=480 height=259 src=https://giphy.com/embed/GYdyfzzDfanrq frameborder allowfullscreen></iframe><p>As you can see in the figure below it is a process which coverts java 8 bytecode generated by javac to java 7 compatible bytecode. This is the secret behind supporting certain java 8 features on all android versions by default toolchain.</p><figure><img loading=lazy src=images/bytecode_transformations.webp alt="Java 8 language feature support using desugar bytecode transformations."><figcaption><p><a href=https://developer.android.com/studio/write/java8-support.html>Java 8 language feature support using</a> <code>desugar</code> <a href=https://developer.android.com/studio/write/java8-support.html>bytecode transformations</a>.</p></figcaption></figure><p>Okay so enough theory, let’s see one example of desugaring to make it clear.</p><p>Lambda is one of the popular java 8 feature and all devs love it because it makes your code easy to read by reducing boilerplate code. Since android runtime (ART or dalvik) doesn’t support java 8 natively it won’t be able to recognise lambda. Desugaring converts lambda expression into an anonymous class which is java 7 compatible.</p><p>So you can write click listener on the button using java 8 lambda feature like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>button</span><span class=p>.</span><span class=na>setOnClickListener</span><span class=p>(</span><span class=n>v</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>Log</span><span class=p>.</span><span class=na>d</span><span class=p>(</span><span class=s>&#34;Button clicked&#34;</span><span class=p>));</span><span class=w>
</span></span></span></code></pre></div><p>which gets desugared to something like this</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>button</span><span class=p>.</span><span class=na>setOnClickListener</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>View</span><span class=p>.</span><span class=na>OnClickListener</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onClick</span><span class=p>(</span><span class=n>View</span><span class=w> </span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Log</span><span class=p>.</span><span class=na>d</span><span class=p>(</span><span class=s>&#34;Button clicked&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>});</span><span class=w>
</span></span></span></code></pre></div><p>For more information on default toolchain head over to the <a href=https://developer.android.com/studio/write/java8-support.html>this</a> page.</p><p>Okay, now we know enough about default toolchain so let’s explore advantages of D8 dexer.</p><h2 id=advantages-of-d8-dexer>Advantages of D8 dexer<a hidden class=anchor aria-hidden=true href=#advantages-of-d8-dexer>#</a></h2><p>As I said earlier D8 is a new dex compiler which is integrated with gradle plugin 3.1.0. D8 is faster compare to DX thereby reducing build time and also it generates small .dex file thereby reducing your APK size. Also, it generates optimized .dex which gives you better run time performance.</p><p>Figures below show dex compilation time and dex file size comparison with DX.</p><figure><img loading=lazy src=images/compile_time_comparison.webp alt="Compile time comparison"><figcaption><p><a href=https://android-developers.googleblog.com/2017/08/next-generation-dex-compiler-now-in.html>Compile time comparison</a></p></figcaption></figure><blockquote><p>Tested with benchmark project <a href=https://github.com/jmslau/perf-android-large/tree/android-30>here</a>.</p></blockquote><figure><img loading=lazy src=images/size_comparison.webp alt="DEX size comparison"><figcaption><p><a href=https://android-developers.googleblog.com/2017/08/next-generation-dex-compiler-now-in.html>DEX size comparison</a></p></figcaption></figure><blockquote><p>Tested with benchmark project <a href=https://github.com/jmslau/perf-android-large/tree/android-30>here</a>.</p></blockquote><p>To take advantage of D8 all you need to do is to update your Android Studio to latest version 3.1.0.</p><p>You can further optimize your build time using D8 experimental feature called integrated desugaring. We have seen in default toolchain, desugaring is a separate process which runs immediately after java compilation as shown below.</p><figure><img loading=lazy src=images/default_toolchain_desugaring.webp alt="Default toolchain desugaring"><figcaption><p>Default toolchain desugaring</p></figcaption></figure><p>With new experimental integrated desugaring it will be a part of D8 which will reduce your build time further.</p><figure><img loading=lazy src=images/d8_integrated_desugaring.webp alt="D8 integrated desugaring"><figcaption><p>D8 integrated desugaring</p></figcaption></figure><p>Since it is an experimental feature you have to enable it by adding the following line in your gradle.properties file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>android</span><span class=o>.</span><span class=na>enableD8</span><span class=o>.</span><span class=na>desugaring</span> <span class=o>=</span> <span class=kc>true</span>
</span></span></code></pre></div><p>Once it is stable it will be enabled by default in future Android Studio release.</p><h2 id=whats-next->What’s next ?<a hidden class=anchor aria-hidden=true href=#whats-next->#</a></h2><p>Besides D8 dexer android tools team is also working on R8 shrinker, which is a proguard replacement for whole program minification and optimization. Think of R8 as D8 on steroids. It will convert your java bytecode to .dex by removing unused code and obfuscating it just like proguard.</p><p>Currently, it is not integrated with android gradle plugin but those who are curious about R8 can head over to open-sourced R8 project <a href=https://android.googlesource.com/platform/external/r8/>here</a>.</p><p>Finally, I would like to close this with a resource which will help you to understand D8 and R8 better. Tune into following podcast where <a href=https://twitter.com/chethaase>@chethaase</a> and <a href=https://twitter.com/tornorbye>@tornorbye</a> talk with <a href=https://twitter.com/jvgogh>Jeffrey van Gogh</a> from the Tools team who works on D8 and R8.</p><p><a href=http://androidbackstage.blogspot.in/2018/01/episode-86-its-gr8.html>Episode 86: It&rsquo;s gr8!</a></p><p>In case if you have any question or suggestion you can comment below or get in touch with me on <a href=https://twitter.com/viradiya_sagar>twitter</a>.</p><p>That’s it for now folks :)</p><blockquote><p><em>This was originally posted on <a href=https://medium.com/proandroiddev/the-d8-dexer-6736deb55fb8>Medium</a></em></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://sagarviradiya.dev/tags/android/>Android</a></li><li><a href=https://sagarviradiya.dev/tags/compilation/>Compilation</a></li><li><a href=https://sagarviradiya.dev/tags/tool-chain/>Tool Chain</a></li></ul><nav class=paginav><a class=prev href=https://sagarviradiya.dev/posts/android-jetpack-navigation/><span class=title>« Prev</span><br><span>Android Jetpack - NavigationUI</span>
</a><a class=next href=https://sagarviradiya.dev/posts/getting-started-with-kotlin/><span class=title>Next »</span><br><span>Getting started with kotlin</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://sagarviradiya.dev/>Sagar's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>