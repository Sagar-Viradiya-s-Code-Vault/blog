<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Modern Android app distribution with GitHub Actions Part ‚Äî I | Sagar's Blog</title>
<meta name=keywords content="CI/CD,Github Actions,Android,Internal test track,Automation"><meta name=description content="Modern app distribution"><meta name=author content><link rel=canonical href=https://sagarviradiya.dev/posts/modern-app-distribution-part-01/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.a687a634d6c61e52258d42cba296d4db963631cd7db074138c1a0e92f3e3902a.css integrity="sha256-poemNNbGHlIljULLopbU25Y2Mc19sHQTjBoOkvPjkCo=" rel="preload stylesheet" as=style><link rel=icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Modern Android app distribution with GitHub Actions Part ‚Äî I"><meta property="og:description" content="Modern app distribution"><meta property="og:type" content="article"><meta property="og:url" content="https://sagarviradiya.dev/posts/modern-app-distribution-part-01/"><meta property="og:image" content="https://sagarviradiya.dev/images/header.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-08-31T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-31T00:00:00+00:00"><meta property="og:site_name" content="Sagar's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sagarviradiya.dev/images/header.jpg"><meta name=twitter:title content="Modern Android app distribution with GitHub Actions Part ‚Äî I"><meta name=twitter:description content="Modern app distribution"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sagarviradiya.dev/posts/"},{"@type":"ListItem","position":2,"name":"Modern Android app distribution with GitHub Actions Part ‚Äî I","item":"https://sagarviradiya.dev/posts/modern-app-distribution-part-01/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Modern Android app distribution with GitHub Actions Part ‚Äî I","name":"Modern Android app distribution with GitHub Actions Part ‚Äî I","description":"Modern app distribution","keywords":["CI/CD","Github Actions","Android","Internal test track","Automation"],"articleBody":"Hey folks üëã I hope everyone is safe. Now let me ask you a couple of questions about your build/distribution cycle:\nDo you manually create a build for your testing? Still distributing your android app old school - like sharing over mail or through google drive? If you answered yes to any of those questions, you need to stop what you‚Äôre doing right now and automate your build/distribution cycle.\nThis is a 2 part series on Modern Android Distribution where I am going to help you automate your app distribution through GitHub Actions. So let‚Äôs get started.\nThis blog assumes that you are well versed with GitHub Actions. If not then I highly recommend exploring it and come back.\nIn this part, we will be looking at how to automate internal app distribution through Internal App Sharing.\nAutomating internal app distribution through Internal App Sharing Internal App Sharing is an excellent tool on Play console which allows you to share aab/apk internally with your QA team and other stakeholders. At BookMyShow, we are using it for sharing feature builds and integrated builds with the QA team. The whole experience is as good as installing an app from the play store except it is restricted to whitelisted emails. No more side-loading needed, and if that wasn‚Äôt good enough, you could even integrate it into your workflow to share it on Slack once you upload apk/aab to Internal App Sharing(IAS).\nAt a high level, this is what we are looking at:\nBuild ‚Äî\u003e Upload aab/apk to IAS ‚Äî\u003e Share link from the previous step on Slack.\nLet‚Äôs build our workflow.\nYou will need to decide on an event that triggers your workflow. It could be a push event to a specific branch or some other event. In most of the cases, it is a push event to a branch from where you are sharing an internal build with the QA team. Let‚Äôs configure that first.\nname: Build, Upload to IAS and share on slack. on: push: branches: # Specify branch from where you are sharing build - [branch_name] Now let‚Äôs see how to configure the build step we discussed earlier.\njobs: build: name: Building app runs-on: ubuntu-latest steps: - name: Checking out branch uses: actions/checkout@v2 with: # Specify branch from where you are sharing build ref: '[branch_name]' - name: Setting up JDK 1.8 uses: actions/setup-java@v1 with: java-version: 1.8 - name: Running build command # Run your own gradle command to generate build. run: ./gradlew bundleRelease - name: Uploading build uses: actions/upload-artifact@v2 with: name: bundle path: app/build/outputs/bundle/release/app-release.aab As you can see, the build job has four tasks. This job, as we have specified, runs on an instance of a Linux machine. Just like you checkout a branch on your new machine when you setup any project, here you will need to checkout the branch from where you would like to create a build.\nStep 1: checking out branch ‚Äî does that using a custom action actions/checkout@v2.\nStep 2: setting up JDK ‚Äî will setup JDK so that we can compile our project using a custom action actions/setup-java@v1.\nStep 3: running build command ‚Äî executes the Gradle command to create a bundle (you can build an apk too if you are not using bundle).\nStep 4 uploads our generated bundle so that we access it later in our next job ‚Äî note that we have given a name to our artifact called ‚Äòbundle‚Äô so that we can refer to it later. Also, we have mentioned the file path of our bundle to be uploaded. If you want to share a file across jobs this is how you can achieve it. It uses custom action actions/upload-artifact@v2.\nAlright so we are halfway through our workflow and so far we have managed to build and store our bundle on artifact so that we can use it in our next job.\nLet‚Äôs move on to our next job but before that‚Ä¶\nReady? Let‚Äôs move on then!\nSince the last job is quite complex we will break it down into different steps.\nEach job runs on a different instance of a Linux machine. Just how we configured our previous job, this job too runs on an instance of Linux.\nNote the special ‚Äòneeds‚Äô tag at line number 3 below. That tells GitHub that this job has a dependency on the name specified. In our case, it is build job.\nOur final job has 3 steps. First, we download the build that we stored in the last step of the previous job. We are referring to an artifact that we want to download through the name that we have given ‚Äòbundle‚Äô.\nupload_to_internal_app_sharing: name: Uploading build to IAS needs: build runs-on: ubuntu-latest steps: - name: Downloading build uses: actions/download-artifact@v2 with: name: bundle Once we have bundle it‚Äôs time to upload it to Internal App Sharing.\nMy fellow engineers at BookMyShow and I have written a custom GitHub action which allows you to upload your build to Internal App Sharing.\nThis action requires 3 things to upload your build to IAS.\nYour service account JSON in text format (we recommend to set it in your GitHub secret) Your application‚Äôs package name And the path to your build For the first two of those, you need to replace with your service account JSON as GitHub secret. The last one would simply be a file name since the downloaded artifact would be at the root level unless you specify a custom path. In case you specify a custom path while downloading, please make sure you use the same path here.\nThis action spits out 3 outputs\ndownloadUrl - The download URL generated for the uploaded artifact certificateFingerprint - The SHA256 fingerprint of the certificate used to sign the generated artifact sha256 - The SHA-256 hash of the artifact Here is the step for uploading to Internal App Sharing.\n- name: Uplaoding to IAS id: ias uses: sagar-viradiya/internal-app-sharing-action@v1.1.0 with: # Your service account JSON GitHub secret serviceAccountJsonPlainText: ${{ secrets.[your-github-service-acc-json-secret] }} # Your package name packageName: '[your-package-name]' aabFilePath: 'app-release.aab' In our next and final step, we notify downloadUrl output from above step on slack. Again it is using custom action rtCamp/action-slack-notify@v2.1.0. You need to mention the following :\nYour slack webhook Channel where you want to notify Message ‚Äî In our case downloadUrl output from previous step Title (Default would be ‚ÄòMessage‚Äô) Slack user name (Default would be ‚ÄòrtBot‚Äô) ‚Äî The name of the sender of the message. Does not need to be a ‚Äúreal‚Äù username - name: Sharing on slack uses: rtCamp/action-slack-notify@v2.1.0 env: # Your slack webhook GitHub secret SLACK_WEBHOOK: ${{ secrets.[your-slack-webhook] }} # Slack channel where you want to notify SLACK_CHANNEL: [your-channel] SLACK_USERNAME: \"JARVIS\" SLACK_TITLE: \"Internal testing build\" SLACK_MESSAGE: ${{ steps.ias.outputs.downloadUrl }} Voila! Your workflow for automating build and distribution through Internal App Sharing is ready!\nHere is gist of the full workflow üëá\nIn the next one, we will be exploring how to automate your production release, so stay tuned!\nSee you in part 2 üëã\nStay safe!\nThanks Adnan A M for proofreading this.\nThis was originally posted on DEV Community\n","wordCount":"1179","inLanguage":"en","image":"https://sagarviradiya.dev/images/header.jpg","datePublished":"2020-08-31T00:00:00Z","dateModified":"2020-08-31T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sagarviradiya.dev/posts/modern-app-distribution-part-01/"},"publisher":{"@type":"Organization","name":"Sagar's Blog","logo":{"@type":"ImageObject","url":"https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sagarviradiya.dev/ accesskey=h title="Sagar Viradiya (Alt + H)"><img src=https://sagarviradiya.dev/apple-touch-icon.png alt aria-label=logo height=35>Sagar Viradiya</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sagarviradiya.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://sagarviradiya.dev/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://sagarviradiya.dev/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://sagarviradiya.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sagarviradiya.dev/>Home</a>&nbsp;¬ª&nbsp;<a href=https://sagarviradiya.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Modern Android app distribution with GitHub Actions Part ‚Äî I</h1><div class=post-meta><span title='2020-08-31 00:00:00 +0000 UTC'>August 31, 2020</span>&nbsp;¬∑&nbsp;6 min&nbsp;¬∑&nbsp;1179 words</div></header><figure class=entry-cover><a href=https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header.jpg target=_blank rel="noopener noreferrer"><img loading=eager srcset="https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header_hu5459c0360c2b0cb7a147d2df0eb350ca_2477162_360x0_resize_q75_box.jpg 360w ,https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header_hu5459c0360c2b0cb7a147d2df0eb350ca_2477162_480x0_resize_q75_box.jpg 480w ,https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header_hu5459c0360c2b0cb7a147d2df0eb350ca_2477162_720x0_resize_q75_box.jpg 720w ,https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header_hu5459c0360c2b0cb7a147d2df0eb350ca_2477162_1080x0_resize_q75_box.jpg 1080w ,https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header_hu5459c0360c2b0cb7a147d2df0eb350ca_2477162_1500x0_resize_q75_box.jpg 1500w ,https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header.jpg 5472w" sizes="(min-width: 768px) 720px, 100vw" src=https://sagarviradiya.dev/posts/modern-app-distribution-part-01/images/header.jpg alt="Photo by [Bernd üì∑ Dittrich](https://unsplash.com/@hdbernd?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash) on [Unsplash](https://unsplash.com/photos/white-and-green-bus-on-road-during-daytime-0vAAngcguI0?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash)" width=5472 height=3648></a><p>Photo by <a href="https://unsplash.com/@hdbernd?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Bernd üì∑ Dittrich</a> on <a href="https://unsplash.com/photos/white-and-green-bus-on-road-during-daytime-0vAAngcguI0?utm_content=creditCopyText&amp;utm_medium=referral&amp;utm_source=unsplash">Unsplash</a></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#automating-internal-app-distribution-through-internal-app-sharing>Automating internal app distribution through Internal App Sharing</a></li></ul></nav></div></details></div><div class=post-content><p>Hey folks üëã I hope everyone is safe. Now let me ask you a couple of questions about your build/distribution cycle:</p><ul><li>Do you manually create a build for your testing?</li><li>Still distributing your android app old school - like sharing over mail or through google drive?</li></ul><p>If you answered yes to any of those questions, you need to stop what you‚Äôre doing right now and automate your build/distribution cycle.</p><p>This is a 2 part series on Modern Android Distribution where I am going to help you automate your app distribution through GitHub Actions. So let‚Äôs get started.</p><blockquote><p><em>This blog assumes that you are well versed with <a href=https://github.com/features/actions>GitHub Actions</a>. If not then I highly recommend exploring it and come back.</em></p></blockquote><p>In this part, we will be looking at how to automate internal app distribution through Internal App Sharing.</p><h2 id=automating-internal-app-distribution-through-internal-app-sharing>Automating internal app distribution through Internal App Sharing<a hidden class=anchor aria-hidden=true href=#automating-internal-app-distribution-through-internal-app-sharing>#</a></h2><p><a href="https://support.google.com/googleplay/android-developer/answer/9303479?hl=en">Internal App Sharing</a> is an excellent tool on Play console which allows you to share aab/apk internally with your QA team and other stakeholders. At BookMyShow, we are using it for sharing feature builds and integrated builds with the QA team. The whole experience is as good as installing an app from the play store except it is restricted to whitelisted emails. No more side-loading needed, and if that wasn‚Äôt good enough, you could even integrate it into your workflow to share it on Slack once you upload apk/aab to Internal App Sharing(IAS).</p><p>At a high level, this is what we are looking at:</p><p><em>Build ‚Äî> Upload aab/apk to IAS ‚Äî> Share link from the previous step on Slack.</em></p><p>Let‚Äôs build our workflow.</p><p>You will need to decide on an event that triggers your workflow. It could be a push event to a specific branch or <a href=https://docs.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#triggering-a-workflow-with-events>some other event</a>. In most of the cases, it is a push event to a branch from where you are sharing an internal build with the QA team. Let‚Äôs configure that first.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build, Upload to IAS and share on slack.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Specify branch from where you are sharing build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=p>[</span><span class=l>branch_name]</span><span class=w>
</span></span></span></code></pre></div><p>Now let‚Äôs see how to configure the build step we discussed earlier.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Building app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checking out branch</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c># Specify branch from where you are sharing build        </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ref</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;[branch_name]&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setting up JDK 1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-java@v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>java-version</span><span class=p>:</span><span class=w> </span><span class=m>1.8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Running build command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># Run your own gradle command to generate build.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./gradlew bundleRelease</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Uploading build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/upload-artifact@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bundle</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>app/build/outputs/bundle/release/app-release.aab</span><span class=w>
</span></span></span></code></pre></div><p>As you can see, the build job has four tasks. This job, as we have specified, runs on an instance of a Linux machine. Just like you checkout a branch on your new machine when you setup any project, here you will need to checkout the branch from where you would like to create a build.</p><ul><li><p>Step 1: <strong>checking out branch</strong> ‚Äî does that using a custom action <code>actions/checkout@v2</code>.</p></li><li><p>Step 2: <strong>setting up JDK</strong> ‚Äî will setup JDK so that we can compile our project using a custom action <em><code>actions/setup-java@v1</code></em>.</p></li><li><p>Step 3: <strong>running build command</strong> ‚Äî executes the Gradle command to create a bundle (you can build an apk too if you are not using bundle).</p></li><li><p>Step 4 uploads our generated bundle so that we access it later in our next job ‚Äî note that we have given a name to our artifact called ‚Äòbundle‚Äô so that we can refer to it later. Also, we have mentioned the file path of our bundle to be uploaded. If you want to share a file across jobs this is how you can achieve it. It uses custom action <em><code>actions/upload-artifact@v2</code></em>.</p></li></ul><p>Alright so we are halfway through our workflow and so far we have managed to build and store our bundle on artifact so that we can use it in our next job.</p><p>Let‚Äôs move on to our next job but before that‚Ä¶</p><iframe width=480 height=480 src=https://giphy.com/embed/26hitpANolPjPmoCc frameborder allowfullscreen></iframe><p>Ready? Let‚Äôs move on then!</p><p>Since the last job is quite complex we will break it down into different steps.</p><p>Each job runs on a different instance of a Linux machine. Just how we configured our previous job, this job too runs on an instance of Linux.</p><p>Note the special <em>‚Äòneeds‚Äô</em> tag at line number 3 below. That tells GitHub that this job has a dependency on the name specified. In our case, it is build job.</p><p>Our final job has 3 steps. First, we download the build that we stored in the last step of the previous job. We are referring to an artifact that we want to download through the name that we have given <em>‚Äòbundle‚Äô</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>upload_to_internal_app_sharing</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Uploading build to IAS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Downloading build</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/download-artifact@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>bundle</span><span class=w>
</span></span></span></code></pre></div><p>Once we have bundle it‚Äôs time to upload it to Internal App Sharing.</p><p>My fellow engineers at BookMyShow and I have written a <a href=https://github.com/sagar-viradiya/internal-app-sharing-action>custom GitHub action</a> which allows you to upload your build to Internal App Sharing.</p><p>This action requires 3 things to upload your build to IAS.</p><ol><li>Your service account JSON in text format (we recommend to set it in your GitHub secret)</li><li>Your application‚Äôs package name</li><li>And the path to your build</li></ol><p>For the first two of those, you need to replace with your service account JSON as GitHub secret. The last one would simply be a file name since the downloaded artifact would be at the root level unless you specify a custom path. In case you specify a custom path while downloading, please make sure you use the same path here.</p><p>This action spits out 3 outputs</p><ol><li><strong><code>downloadUrl</code></strong> - The download URL generated for the uploaded artifact</li><li><strong><code>certificateFingerprint</code></strong> - The SHA256 fingerprint of the certificate used to sign the generated artifact</li><li><strong><code>sha256</code></strong> - The SHA-256 hash of the artifact</li></ol><p>Here is the step for uploading to Internal App Sharing.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Uplaoding to IAS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>ias</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>sagar-viradiya/internal-app-sharing-action@v1.1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Your service account JSON GitHub secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>serviceAccountJsonPlainText</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.[your-github-service-acc-json-secret] }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Your package name </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>packageName</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;[your-package-name]&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>aabFilePath</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;app-release.aab&#39;</span><span class=w>
</span></span></span></code></pre></div><p>In our next and final step, we notify <strong><code>downloadUrl</code></strong> output from above step on slack. Again it is using custom action <strong><code>rtCamp/action-slack-notify@v2.1.0</code></strong>. You need to mention the following :</p><ol><li>Your slack webhook</li><li>Channel where you want to notify</li><li>Message ‚Äî In our case <strong><code>downloadUrl</code></strong> output from previous step</li><li>Title (Default would be ‚ÄòMessage‚Äô)</li><li>Slack user name (Default would be ‚ÄòrtBot‚Äô) ‚Äî The name of the sender of the message. Does not need to be a ‚Äúreal‚Äù username</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Sharing on slack</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>rtCamp/action-slack-notify@v2.1.0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Your slack webhook GitHub secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SLACK_WEBHOOK</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.[your-slack-webhook] }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=c># Slack channel where you want to notify</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SLACK_CHANNEL</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>your-channel]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SLACK_USERNAME</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;JARVIS&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SLACK_TITLE</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Internal testing build&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>SLACK_MESSAGE</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.ias.outputs.downloadUrl }}</span><span class=w>
</span></span></span></code></pre></div><p>Voila! Your workflow for automating build and distribution through Internal App Sharing is ready!</p><p>Here is gist of the full workflow üëá</p><script src="https://gist.github.com/sagar-viradiya/de5f448e811f587b2c599b0a9a7cdb9f.js?file=internal-app-sharing-workflow.yml"></script><p>In the next one, we will be exploring how to automate your production release, so stay tuned!</p><p>See you in part 2 üëã</p><p>Stay safe!</p><p><em>Thanks <a href=https://medium.com/u/6e51ff92a37b>Adnan A M</a> for proofreading this.</em></p><blockquote><p><em>This was originally posted on <a href=https://dev.to/sagarviradiya/modern-android-app-distribution-with-github-actions-part-i-5pp>DEV Community</a></em></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://sagarviradiya.dev/tags/ci/cd/>CI/CD</a></li><li><a href=https://sagarviradiya.dev/tags/github-actions/>Github Actions</a></li><li><a href=https://sagarviradiya.dev/tags/android/>Android</a></li><li><a href=https://sagarviradiya.dev/tags/internal-test-track/>Internal test track</a></li><li><a href=https://sagarviradiya.dev/tags/automation/>Automation</a></li></ul><nav class=paginav><a class=prev href=https://sagarviradiya.dev/posts/modern-app-distribution-part-02/><span class=title>¬´ Prev</span><br><span>Modern Android app distribution with GitHub Actions Part ‚Äî II</span>
</a><a class=next href=https://sagarviradiya.dev/posts/droidcon-india-experience/><span class=title>Next ¬ª</span><br><span>My experience at Droidcon India 2019 üáÆüá≥</span></a></nav></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//sagarviradiya-dev.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://sagarviradiya.dev/>Sagar's Blog</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>