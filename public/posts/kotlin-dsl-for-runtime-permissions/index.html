<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kotlin DSL for runtime permissions | Sagar's Blog</title>
<meta name=keywords content="Android,Kotlin,Runtime Permissions"><meta name=description content="A kotlin syntactic sugar on runtime permissions"><meta name=author content><link rel=canonical href=https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.0ca7eb5c58d462c1500c10b5503144143e6a21142fc22557ae94a8112158af8d.css integrity="sha256-DKfrXFjUYsFQDBC1UDFEFD5qIRQvwiVXrpSoESFYr40=" rel="preload stylesheet" as=style><link rel=icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Kotlin DSL for runtime permissions"><meta property="og:description" content="A kotlin syntactic sugar on runtime permissions"><meta property="og:type" content="article"><meta property="og:url" content="https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/"><meta property="og:image" content="https://sagarviradiya.dev/images/header.webp"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-07T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-07T00:00:00+00:00"><meta property="og:site_name" content="Sagar's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sagarviradiya.dev/images/header.webp"><meta name=twitter:title content="Kotlin DSL for runtime permissions"><meta name=twitter:description content="A kotlin syntactic sugar on runtime permissions"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sagarviradiya.dev/posts/"},{"@type":"ListItem","position":2,"name":"Kotlin DSL for runtime permissions","item":"https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kotlin DSL for runtime permissions","name":"Kotlin DSL for runtime permissions","description":"A kotlin syntactic sugar on runtime permissions","keywords":["Android","Kotlin","Runtime Permissions"],"articleBody":"A while back I open-sourced an Android library eazypermissions for runtime permissions which allows you to request permission within coroutines (no callback yay ðŸŽ‰) and has support for LiveData as well. If you are interested you can read more about it ðŸ‘‡\nEazy permissions\nThe library now offers a Kotlin DSL to request permissions. In this post, we will discuss the DSL API and how to request permissions using the DSL. Letâ€™s get started.\nKotlin DSL for requesting permissions While requesting permissions three things that matter are permissions, the request code, and the result. The DSL API focuses on these three things and allows you to request permissions cleanly and concisely. Letâ€™s see how.\nIf you are requesting permission in Activity/Fragment you can request permissions as shown below.\nrequestPermissions( Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.READ_CONTACTS, Manifest.permission.CAMERA ) { requestCode = 4 resultCallback = { when (this) { is PermissionResult.PermissionGranted -\u003e { Toast.makeText(requireContext(), \"Granted!\", Toast.LENGTH_LONG).show() } is PermissionResult.PermissionDenied -\u003e { Toast.makeText(requireContext(), \"Denied\", Toast.LENGTH_SHORT).show() } is PermissionResult.ShowRational -\u003e { Toast.makeText(requireContext(), \"Rational\", Toast.LENGTH_SHORT).show() } is PermissionResult.PermissionDeniedPermanently -\u003e { Toast.makeText(requireContext(), \"Denied permanently\", Toast.LENGTH_SHORT).show() } } } } Now letâ€™s understand the above DSL.\nThe requestPermissions function is an extension function on Activity and Fragment so you can call it directly from activity and fragment. It takes vararg of permissions that you want to request and lambda with a receiver on PermissionRequest. Since it is a lambda with a receiver on PermissionRequest you have direct access to members of PermissionRequest. Within lambda, you initialize two members of PermissionRequest, requestCode and resultCallback. Here is the definition of PermissionRequest class.\n/** * Represents permission request encapsulating [requestCode] and * [resultCallback] for a permission request. */ class PermissionRequest ( var requestcode: Int? = null, var resultcallback: (PermissionResult.() -\u003e Unit)? = null ) resultCallback is again a lambda with a receiver on PermissionResult and the library will invoke this callback for a result. Inside the lambda, you can directly refer permission result as this. PermissionResult is nothing but the simple sealed class which wraps all possible outcomes i.e Permission granted, denied, denied permanently and show rational.\nHere are the signatures of requestPermissions extension functions on Activity and Fragment.\n/** * @param permissions vararg of all the permissions for request. * @param requestBlock block constructing [PermissionRequest] object for permission request. */ inline fun AppCompatActivity.requestPermissions( vararg permissions: String, requestBlock: PermissionRequest.() -\u003e Unit ) /** * @param permissions vararg of all the permissions for request. * @param requestBlock block constructing [PermissionRequest] object for permission request. */ inline fun Fragment.requestPermissions( vararg permissions: String, requestBlock: PermissionRequest.() -\u003e Unit ) If you are requesting permission outside your Fragment/Activity you can request permissions as shown below.\nPermissionManager.requestPermissions( fragment, //Instance of Fragment or Activity Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.READ_CONTACTS, Manifest.permission.CAMERA ) { requestCode = 4 resultCallback = { when (this) { is PermissionResult.PermissionGranted -\u003e { Toast.makeText(requireContext(), \"Granted!\", Toast.LENGTH_LONG).show() } is PermissionResult.PermissionDenied -\u003e { Toast.makeText(requireContext(), \"Denied\", Toast.LENGTH_ SHORT).show() } is PermissionResult.ShowRational -\u003e { Toast.makeText(requireContext(), \"Rational\", Toast.LENGTH_SHORT).show() } is PermissionResult.PermissionDeniedPermanently -\u003e { Toast.makeText(requireContext(), \"Denied permanently\", Toast.LENGTH_SHORT).show() } } } } The only difference here is you need to call PermissionManager.requestPermissions which takes an instance of Fragment/Activity as an additional parameter. The extension function we saw previously internally delegates call to this function.\nHere are the signatures of PermissionManager.requestPermissions functions.\n/** * A static factory inline method to request permission for activity. * * @param activity an instance of [AppCompatActivity] * @param permissions vararg of all permissions for request * @param requestBlock [PermissionRequest] block for permission request * */ inline fun requestPermissions( activity: AppCompatActivity, vararg permissions: String, requestBlock: PermissionRequest.() -\u003e Unit ) /** * A static factory inline method to request permission for fragment. * * @param fragment an instance of [Fragment] * @param permissions vararg of all permissions for request * @param requestBlock [PermissionRequest] block for permission request * */ inline fun requestPermissions( fragment: Fragment, vararg permissions: String, requestBlock: PermissionRequest.() -\u003e Unit ) How you include the library in your project.\nimplementation 'com.sagar:dslpermission:2.0.0' Thatâ€™s all I have for this new Kotlin DSL feature. Head over to the GitHub repo below for more details about the library.\nhttps://github.com/sagar-viradiya/eazypermissions\nIf you have any suggestions please feel free to comment below or you can reach out to me on Twitter.\nThatâ€™s it, for now, folks ðŸ™‚ Until next time ðŸ‘‹\nHappy coding ðŸ˜ƒ\nThis was originally posted on Medium\n","wordCount":"710","inLanguage":"en","image":"https://sagarviradiya.dev/images/header.webp","datePublished":"2019-10-07T00:00:00Z","dateModified":"2019-10-07T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/"},"publisher":{"@type":"Organization","name":"Sagar's Blog","logo":{"@type":"ImageObject","url":"https://sagarviradiya.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sagarviradiya.dev/ accesskey=h title="127.0.0.1 (Alt + H)"><img src=https://sagarviradiya.dev/apple-touch-icon.png alt aria-label=logo height=35>127.0.0.1</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sagarviradiya.dev/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://sagarviradiya.dev/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://sagarviradiya.dev/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://sagarviradiya.dev/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sagarviradiya.dev/>Home</a>&nbsp;Â»&nbsp;<a href=https://sagarviradiya.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Kotlin DSL for runtime permissions</h1><div class=post-meta><span title='2019-10-07 00:00:00 +0000 UTC'>October 7, 2019</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;710 words</div></header><figure class=entry-cover><a href=https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header.webp target=_blank rel="noopener noreferrer"><img loading=eager srcset="https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header_hu9e74ee961b27b82aa98b58fe36ec294a_685926_360x0_resize_q75_h2_box_2.webp 360w ,https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header_hu9e74ee961b27b82aa98b58fe36ec294a_685926_480x0_resize_q75_h2_box_2.webp 480w ,https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header_hu9e74ee961b27b82aa98b58fe36ec294a_685926_720x0_resize_q75_h2_box_2.webp 720w ,https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header_hu9e74ee961b27b82aa98b58fe36ec294a_685926_1080x0_resize_q75_h2_box_2.webp 1080w ,https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header_hu9e74ee961b27b82aa98b58fe36ec294a_685926_1500x0_resize_q75_h2_box_2.webp 1500w ,https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header.webp 4032w" sizes="(min-width: 768px) 720px, 100vw" src=https://sagarviradiya.dev/posts/kotlin-dsl-for-runtime-permissions/images/header.webp alt="Shot on my Pixel 3a XL" width=4032 height=3024></a><p>Shot on my Pixel 3a XL</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#kotlin-dsl-for-requesting-permissions>Kotlin DSL for requesting permissions</a></li></ul></nav></div></details></div><div class=post-content><p>A while back I open-sourced an Android library <a href=https://github.com/sagar-viradiya/eazypermissions><strong>eazypermissions</strong></a> for runtime permissions which allows you to request permission within coroutines (no callback yay ðŸŽ‰) and has support for LiveData as well. If you are interested you can read more about it ðŸ‘‡</p><p><a href=https://sagarviradiya.dev/posts/eazy-permissions/>Eazy permissions</a></p><p>The library now offers a Kotlin DSL to request permissions. In this post, we will discuss the DSL API and how to request permissions using the DSL. Letâ€™s get started.</p><h2 id=kotlin-dsl-for-requesting-permissions>Kotlin DSL for requesting permissions<a hidden class=anchor aria-hidden=true href=#kotlin-dsl-for-requesting-permissions>#</a></h2><p>While requesting permissions three things that matter are permissions, the request code, and the result. The DSL API focuses on these three things and allows you to request permissions cleanly and concisely. Letâ€™s see how.</p><p>If you are requesting permission in Activity/Fragment you can request permissions as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=n>requestPermissions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>ACCESS_FINE_LOCATION</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>READ_CONTACTS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>CAMERA</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>requestCode</span> <span class=p>=</span> <span class=m>4</span>
</span></span><span class=line><span class=cl>    <span class=n>resultCallback</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>when</span> <span class=p>(</span><span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionGranted</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Granted!&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_LONG</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionDenied</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Denied&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span> 
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>ShowRational</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Rational&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionDeniedPermanently</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Denied permanently&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now letâ€™s understand the above DSL.</p><p>The <a href=https://github.com/sagar-viradiya/eazypermissions/blob/8e2bdc0b3905cc9f09df5160ada30ca4eb424e70/dslpermission/src/main/java/com/eazypermissions/dsl/extension/Extensions.kt#L28><code>requestPermissions</code></a> function is an extension function on Activity and Fragment so you can call it directly from activity and fragment. It takes <code>vararg</code> of permissions that you want to request and lambda with a receiver on PermissionRequest. Since it is a lambda with a receiver on <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/dslpermission/src/main/java/com/eazypermissions/dsl/model/PermissionRequest.kt><code>PermissionRequest</code></a> you have direct access to members of <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/dslpermission/src/main/java/com/eazypermissions/dsl/model/PermissionRequest.kt><code>PermissionRequest</code></a>. Within lambda, you initialize two members of <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/dslpermission/src/main/java/com/eazypermissions/dsl/model/PermissionRequest.kt><code>PermissionRequest</code></a>, <code>requestCode</code> and <code>resultCallback</code>.
Here is the definition of <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/dslpermission/src/main/java/com/eazypermissions/dsl/model/PermissionRequest.kt><code>PermissionRequest</code></a> class.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* Represents permission request encapsulating [requestCode] and
</span></span></span><span class=line><span class=cl><span class=cm>* [resultCallback] for a permission request.
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PermissionRequest</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>requestcode</span><span class=p>:</span> <span class=n>Int</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=py>resultcallback</span><span class=p>:</span> <span class=p>(</span><span class=nc>PermissionResult</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span><span class=p>)?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p><code>resultCallback</code> is again a lambda with a receiver on <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/common/src/main/java/com/eazypermissions/common/model/PermissionResult.kt><code>PermissionResult</code></a> and the library will invoke this callback for a result. Inside the lambda, you can directly refer permission result as <code>this</code>. <a href=https://github.com/sagar-viradiya/eazypermissions/blob/master/common/src/main/java/com/eazypermissions/common/model/PermissionResult.kt><code>PermissionResult</code></a> is nothing but the simple sealed class which wraps all possible outcomes i.e Permission granted, denied, denied permanently and show rational.</p><p>Here are the signatures of <code>requestPermissions</code> extension functions on Activity and Fragment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* @param permissions vararg of all the permissions for request.
</span></span></span><span class=line><span class=cl><span class=cm>* @param requestBlock block constructing [PermissionRequest] object for permission request.
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=k>inline</span> <span class=k>fun</span> <span class=nf>AppCompatActivity</span><span class=p>.</span><span class=n>requestPermissions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>vararg</span> <span class=n>permissions</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>requestBlock</span><span class=p>:</span> <span class=nc>PermissionRequest</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* @param permissions vararg of all the permissions for request.
</span></span></span><span class=line><span class=cl><span class=cm>* @param requestBlock block constructing [PermissionRequest] object for permission request.
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=k>inline</span> <span class=k>fun</span> <span class=nf>Fragment</span><span class=p>.</span><span class=n>requestPermissions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>vararg</span> <span class=n>permissions</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>requestBlock</span><span class=p>:</span> <span class=nc>PermissionRequest</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>If you are requesting permission outside your Fragment/Activity you can request permissions as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nc>PermissionManager</span><span class=p>.</span><span class=n>requestPermissions</span><span class=p>(</span> 
</span></span><span class=line><span class=cl>    <span class=n>fragment</span><span class=p>,</span> <span class=c1>//Instance of Fragment or Activity
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>ACCESS_FINE_LOCATION</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>READ_CONTACTS</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nc>Manifest</span><span class=p>.</span><span class=n>permission</span><span class=p>.</span><span class=n>CAMERA</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>requestCode</span> <span class=p>=</span> <span class=m>4</span>
</span></span><span class=line><span class=cl>    <span class=n>resultCallback</span> <span class=p>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>when</span> <span class=p>(</span><span class=k>this</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionGranted</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Granted!&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_LONG</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionDenied</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Denied&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_</span> <span class=n>SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>ShowRational</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Rational&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>is</span> <span class=nc>PermissionResult</span><span class=p>.</span><span class=n>PermissionDeniedPermanently</span> <span class=o>-&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=n>requireContext</span><span class=p>(),</span> <span class=s2>&#34;Denied permanently&#34;</span><span class=p>,</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The only difference here is you need to call <code>PermissionManager.requestPermissions</code> which takes an instance of Fragment/Activity as an additional parameter. The extension function we saw previously internally delegates call to this function.</p><p>Here are the signatures of <code>PermissionManager.requestPermissions</code> functions.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* A static factory inline method to request permission for activity.
</span></span></span><span class=line><span class=cl><span class=cm>*
</span></span></span><span class=line><span class=cl><span class=cm>* @param activity an instance of [AppCompatActivity]
</span></span></span><span class=line><span class=cl><span class=cm>* @param permissions vararg of all permissions for request
</span></span></span><span class=line><span class=cl><span class=cm>* @param requestBlock [PermissionRequest] block for permission request
</span></span></span><span class=line><span class=cl><span class=cm>*
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=k>inline</span> <span class=k>fun</span> <span class=nf>requestPermissions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>activity</span><span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>vararg</span> <span class=n>permissions</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>requestBlock</span><span class=p>:</span> <span class=nc>PermissionRequest</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>* A static factory inline method to request permission for fragment.
</span></span></span><span class=line><span class=cl><span class=cm>*
</span></span></span><span class=line><span class=cl><span class=cm>* @param fragment an instance of [Fragment]
</span></span></span><span class=line><span class=cl><span class=cm>* @param permissions vararg of all permissions for request
</span></span></span><span class=line><span class=cl><span class=cm>* @param requestBlock [PermissionRequest] block for permission request
</span></span></span><span class=line><span class=cl><span class=cm>*
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl><span class=k>inline</span> <span class=k>fun</span> <span class=nf>requestPermissions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>fragment</span><span class=p>:</span> <span class=n>Fragment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>vararg</span> <span class=n>permissions</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>requestBlock</span><span class=p>:</span> <span class=nc>PermissionRequest</span><span class=p>.()</span> <span class=o>-&gt;</span> <span class=n>Unit</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><p>How you include the library in your project.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-groovy data-lang=groovy><span class=line><span class=cl><span class=n>implementation</span> <span class=s1>&#39;com.sagar:dslpermission:2.0.0&#39;</span>
</span></span></code></pre></div><p>Thatâ€™s all I have for this new Kotlin DSL feature. Head over to the GitHub repo below for more details about the library.</p><p><a href=https://github.com/sagar-viradiya/eazypermissions>https://github.com/sagar-viradiya/eazypermissions</a></p><p>If you have any suggestions please feel free to comment below or you can reach out to me on <a href=https://twitter.com/viradiya_sagar>Twitter</a>.</p><p>Thatâ€™s it, for now, folks ðŸ™‚ Until next time ðŸ‘‹</p><p>Happy coding ðŸ˜ƒ</p><blockquote><p><em>This was originally posted on <a href=https://medium.com/android-news/kotlin-dsl-for-runtime-permissions-ba04dbe0de2c>Medium</a></em></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://sagarviradiya.dev/tags/android/>Android</a></li><li><a href=https://sagarviradiya.dev/tags/kotlin/>Kotlin</a></li><li><a href=https://sagarviradiya.dev/tags/runtime-permissions/>Runtime Permissions</a></li></ul><nav class=paginav><a class=prev href=https://sagarviradiya.dev/posts/droidcon-india-experience/><span class=title>Â« Prev</span><br><span>My experience at Droidcon India 2019 ðŸ‡®ðŸ‡³</span>
</a><a class=next href=https://sagarviradiya.dev/posts/eazy-permissions/><span class=title>Next Â»</span><br><span>Eazy permissions</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://sagarviradiya.dev/>Sagar's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>